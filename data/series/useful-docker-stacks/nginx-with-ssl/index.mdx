---
title: Nginx cÃ¹ng SSL
---

ÄÃ¢y sáº½ lÃ  stack Ä‘áº§u tiÃªn mÃ¬nh muá»‘n giá»›i thiá»‡u, nÃªn cÅ©ng lÃ  stack khÃ¡ Ä‘Æ¡n giáº£n vÃ  phá»• biáº¿n mÃ  cÃ¡c dev hay sá»­ dá»¥ng. NÃ³ sáº½ giÃºp báº¡n deploy cÃ¡c á»©ng dá»¥ng web cá»§a mÃ¬nh lÃªn má»™t **machine** (mÃ¡y tÃ­nh) má»™t cÃ¡ch nhanh chÃ³ng vÃ  dá»… dÃ ng.

## Váº¥n Ä‘á»

Chá»‰ cáº§n search google vá»›i tá»« khÃ³a nhÆ° _"config nginx with docker"_ cháº³ng háº¡n, cÃ¡c báº¡n sáº½ gáº·p khÃ´ng Ã­t tutorial hÆ°á»›ng dáº«n chi tiáº¿t tá»« A-Z, tá»« config cho viá»‡c serve static files cho Ä‘áº¿n proxy cÃ¡c request Ä‘áº¿n cÃ¡c á»©ng dá»¥ng web khÃ¡c.

Tuy nhiÃªn khi deploy má»™t _webserver_ thá»±c táº¿, thÃ¬ ngÆ°á»i ta sáº½ mua _domain_ (tÃªn miá»n), mua cert _SSL_ (chá»©ng chá»‰ báº£o máº­t) Ä‘á»ƒ cÃ³ thá»ƒ truy cáº­p vÃ o _webserver_ báº±ng `https`, hay cÃ¡c giao thá»©c tÆ°Æ¡ng tá»± khÃ¡c nhÆ° `mqtts`, `wss`,.... VÃ  Ä‘Ã¢y lÃ  váº¥n Ä‘á» mÃ  cÃ¡c tutorial trÃªn khÃ´ng hoáº·c Ã­t Ä‘á» cáº­p Ä‘áº¿n, dáº«n Ä‘áº¿n viá»‡c nhiá»u báº¡n thuÃª **VPS**, mua _domain_ xong gáº·p khÃ³ khÄƒn khi config chÃºng vá»›i SSL, thÃ nh ra láº¡i quay láº¡i config má»™t cÃ¡ch thá»§ cÃ´ng.

## VÃ o viá»‡c nÃ o

Äáº·t váº¥n Ä‘á» hÆ¡i dÃ i dÃ²ng má»™t chÃºt nhÆ°ng mÃ¬nh muá»‘n Ä‘á»™c giáº£ hiá»ƒu Ä‘Æ°á»£c lÃ­ do mÃ¬nh muá»‘n chia sáº» bÃ i viáº¿t nÃ y ğŸ˜. Váº­y mÃ¬nh cÃ¹ng vÃ o viá»‡c ngay thÃ´i!!!

### CÃ¡c yÃªu cáº§u cáº§n thiáº¿t

1. Mua _domain_ (recommend) vÃ  cert _SSL_ (báº¯t buá»™c vá»›i bÃ i viáº¿t nÃ y =)))
2. CÃ³ má»™t mÃ¡y tÃ­nh hay VPS cháº¡y Ä‘Æ°á»£c **Docker** vÃ  **Docker Compose** (mÃ¬nh sáº½ khÃ´ng hÆ°á»›ng dáº«n cÃ i Ä‘áº·t á»Ÿ Ä‘Ã¢y, cÃ¡c báº¡n cÃ³ thá»ƒ tÃ¬m kiáº¿m trÃªn google), vÃ  náº¿u Ä‘Ã£ táº­p tÃ nh Ä‘áº¿n nhá»¯ng config, hay tÆ°Æ¡ng lai lÃ m _devops_ mÃ¬nh khuyÃªn cÃ¡c báº¡n lÃ m trÃªn cÃ¡c mÃ¡y tÃ­nh cháº¡y **Linux**, **Ubuntu**,... sáº½ dá»… dÃ ng hÆ¡n (vÃ  ngáº§u hÆ¡n ná»¯a ğŸ˜).
3. Nhá»› trá» **domain** vá» IP cá»§a mÃ¡y báº¡n sá»­ dá»¥ng, Ä‘á»ƒ nhÃ¬n thá»±c táº¿ hÆ¡n nhÃ© ğŸ˜.
4. Config SSL cho domain cá»§a báº¡n, mÃ¬nh sáº½ khÃ´ng hÆ°á»›ng dáº«n á»Ÿ Ä‘Ã¢y, cÃ¡c báº¡n cÃ³ thá»ƒ tÃ¬m kiáº¿m trÃªn google, hoáº·c cÃ³ thá»ƒ sá»­ dá»¥ng [Let's Encrypt](https://letsencrypt.org/) hay [Cloudflare](https://www.cloudflare.com/),... Ä‘á»ƒ cÃ³ thá»ƒ táº¡o cert SSL miá»…n phÃ­.

:::tip

Náº¿u cÃ³ Ä‘iá»u kiá»‡n, cÃ¡c báº¡n nÃªn kiáº¿m má»™t con VPS ram táº§m 4GB Ä‘á»ƒ vá»c váº¡ch, cÅ©ng nhÆ° trá» domain cÃ¡c thá»© dá»… dÃ ng hÆ¡n nhÃ©

:::

### Cáº¥u trÃºc thÆ° má»¥c

```
.
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ nginx.conf
â”œâ”€â”€ index.html
â””â”€â”€ certs
    â”œâ”€â”€ cert.crt
    â””â”€â”€ private.key
```

- `docker-compose.yml`: file config cho docker-compose.
- `nginx.conf`: file config cho nginx.
- `index.html`: file html Ä‘Æ¡n giáº£n Ä‘á»ƒ test (serve static files).
- `certs`: thÆ° má»¥c chá»©a cert SSL (tÃ¹y vÃ o nhÃ  cung cáº¥p SSL mÃ  cÃ¡c báº¡n cÃ³ thá»ƒ nháº­n Ä‘Æ°á»£c nhiá»u file khÃ¡c nhau, nhÆ° tÃªn file khÃ¡c hoáº·c ext cá»§a nÃ³ lÃ  `.pem`, cÃ¡c báº¡n cÃ³ thá»ƒ Ä‘á»•i tÃªn chÃºng hoáº·c config theo Ã½ mÃ¬nh trong file `nginx.conf` nhÃ©).

### File nginx.config

á» Ä‘Ã¢y mÃ¬nh sáº½ ghi Ä‘Ã¨ luÃ´n config máº·c Ä‘á»‹nh cá»§a **nginx**, hoáº·c cÃ¡c báº¡n cÃ³ thá»ƒ táº¡o thÃªm cÃ¡c file trong `sites-available` vÃ  `sites-enabled` Ä‘á»ƒ config cho tá»«ng _domain_ khÃ¡c nhau, mÃ¬nh sáº½ khÃ´ng hÆ°á»›ng dáº«n á»Ÿ Ä‘Ã¢y, cÃ¡c báº¡n cÃ³ thá»ƒ tÃ¬m kiáº¿m trÃªn google nhÃ©.

```nginx
events {
}

http {
    server {
        listen 80;
        server_name your.domain;
        return 301 https://$host$request_uri;
    }

    server {
        listen 443 ssl;
        server_name your.domain;

        ssl_certificate /etc/nginx/certs/cert.crt;
        ssl_certificate_key /etc/nginx/certs/private.key;

        location / {
            root /usr/share/nginx/html;
            index index.html index.htm;
            try_files $uri $uri/ /index.html;
        }
    }
}
```

á» file trÃªn, mÃ¬nh config 2 server, má»™t server Ä‘á»ƒ redirect cÃ¡c request tá»« `http` (port 80) sang `https` (port 443), vÃ  má»™t server Ä‘á»ƒ serve cÃ¡c file tÄ©nh (static files) tá»« thÆ° má»¥c `/usr/share/nginx/html` (thÆ° má»¥c máº·c Ä‘á»‹nh cá»§a nginx).

NgoÃ i ra, mÃ¬nh cÅ©ng config SSL cho server nÃ y, cÃ¡c báº¡n cÃ³ thá»ƒ thay Ä‘á»•i Ä‘Æ°á»ng dáº«n Ä‘áº¿n cert SSL cá»§a mÃ¬nh á»Ÿ Ä‘Ã¢y (nhá»› lÃ  liÃªn quan Ä‘áº¿n bÆ°á»›c config trong `docker-compose` ná»¯a nhÃ©).

### File docker-compose

```yaml
version: '3'

services:
  nginx:
    image: nginx:stable-alpine
    restart: always
    ports:
      - '80:80'
      - '443:443'
    volumes:
      - ./certs:/etc/nginx/certs
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./index.html:/usr/share/nginx/html/index.html
```

á» file trÃªn, mÃ¬nh config má»™t service `nginx` vá»›i image lÃ  `nginx:stable-alpine` (cÃ¡c báº¡n cÃ³ thá»ƒ thay Ä‘á»•i version cá»§a nginx, hoáº·c sá»­ dá»¥ng image khÃ¡c nhÆ° `nginx:latest`,...), vÃ  cÃ¡c báº¡n cÃ³ thá»ƒ thay Ä‘á»•i cÃ¡c config khÃ¡c nhÆ° `restart`, `ports`, `volumes`,... theo Ã½ mÃ¬nh, tuy nhiÃªn default thÃ¬ mÃ¬nh sáº½ map port 80 sang 80, 443 sang 443.

á» pháº§n `volumes`, mÃ¬nh mount thÃªm 2 file `nginx.conf` vÃ  `certs` vÃ o container, Ä‘á»ƒ cÃ³ thá»ƒ config cho nginx vÃ  sá»­ dá»¥ng cert SSL, náº¿u cÃ¡c báº¡n chá»‰nh path cá»§a cÃ¡c file `cert` hay file `config`, file `html` thÃ¬ nhá»› chá»‰nh á»Ÿ cáº£ `docker-compose` vÃ  `nginx.conf` nhÃ©.

### File index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Title nÃ¨</title>
  </head>
  <body>
    <h1>H1 nÃ¨</h1>
  </body>
</html>
```

:::tip
Náº¿u dÃ¹ng **VSCode**, cÃ¡c báº¡n táº¡o file **html** xong, gÃµ `!` rá»“i `Enter` Ä‘á»ƒ táº¡o nhanh file html nhÆ° trÃªn nhÃ© ğŸ˜.
:::

### Cháº¡y thá»­ luÃ´n nÃ o!!!

Äá»ƒ cháº¡y service vÃ o táº¡o, cÃ¡c báº¡n má»Ÿ terminal vÃ  gÃµ:

```bash
docker-compose up -d
```

Sau khi cháº¡y xong, cÃ¡c báº¡n truy cáº­p vÃ o domain cá»§a mÃ¬nh, náº¿u tháº¥y hiá»‡n ra nhÆ° tháº¿ nÃ y lÃ  thÃ nh cÃ´ng rá»“i nhÃ© ğŸ˜.

![result-1](./result-1.png)

NhÆ° cÃ¡c báº¡n Ä‘Ã£ tháº¥y, mÃ¬nh cÃ³ config cho domain `chuoi.click`, vÃ  khi vÃ o browser, nÃ³ sáº½ hiá»‡n hÃ¬nh cÃ¡i khÃ³a trÆ°á»›c Ä‘á»‹a chá»‰, nhÆ° váº­y lÃ  config SSL thÃ nh cÃ´ng rá»“i nhÃ© ğŸ˜.

## Káº¿t

ÄÃ¢y lÃ  hÆ°á»›ng dáº«n ráº¥t ráº¥t basic, vÃ¬ váº­y cÃ³ thá»ƒ nÃ³ chÆ°a phÃ¹ há»£p vá»›i app thá»±c táº¿, chá»§ yáº¿u Ä‘á»ƒ cÃ¡c báº¡n táº­p lÃ m quen vá»›i cÃ¡c khÃ¡i niá»‡m cÆ¡ báº£n cá»§a **docker** vÃ  **docker-compose**, cÅ©ng nhÆ° map volumes, hay biáº¿t cÃ¡c bÆ°á»›c cáº§n thiáº¿t Ä‘á»ƒ deploy má»™t á»©ng dá»¥ng web cÃ³ SSL.

:::note
NgoÃ i serve file HTML nhÆ° trÃªn, cÃ¡c báº¡n hoÃ n toÃ n cÃ³ thá»ƒ proxy cÃ¡c request Ä‘áº¿n cÃ¡c service khÃ¡c nhÆ° `nodejs`, `php`,... hoáº·c cÃ¡c báº¡n cÃ³ thá»ƒ táº¡o thÃªm cÃ¡c file config khÃ¡c trong `sites-available` vÃ  `sites-enabled` Ä‘á»ƒ config cho tá»«ng _domain_ khÃ¡c nhau, náº¿u muá»‘n thá»­ thÃ¬ coi nhÆ° lÃ  bÃ i táº­p thá»±c hÃ nh nhÃ© ğŸ˜.
:::

## Tham kháº£o

- [https://docs.docker.com/compose/](https://docs.docker.com/compose/)
- [https://docs.nginx.com/nginx/admin-guide/web-server/serving-static-content/](https://docs.nginx.com/nginx/admin-guide/web-server/serving-static-content/)
